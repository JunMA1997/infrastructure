{
    "AWSTemplateFormatVersion": "2020-2-17",
    "Description": "Launch EC2 with requirement url:https://spring2020.csye6225.cloud/assignments/05/#aws-networking-setup",
    "Parameters": {
      "VPC_CIDR":{
        "Type":"String"
      },
      "Subnet_CIDR_0":{
        "Type":"String"
      },
      "Subnet_CIDR_1":{
        "Type":"String"
      },
      "Subnet_CIDR_2":{
        "Type":"String"
      },
      "VPC_NAME":{
        "Type":"String"
      },
      "AWS_region":{
        "Type":"String"
      }
    },
    "Resources": {
      "EC2_VPC_0":{
        "Name":{"Ref":"VPC_NAME"},
        "Type":"AWS::EC2::VPC",
        "Properties":{
          "CidrBlock": {"Ref":"VPC_CIDR"}
        }
      },
      "EC2_SUBNET_0":{
        "Type":"AWS::EC2::Subnet",
        "VpcId": {"Ref" :"EC2_VPC_0"},
        "CidrBlock":{"Ref":"Subnet_CIDR_0"},
        "Properties":{}
      },
      "EC2_SUBNET_1":{
        "Type":"AWS::EC2::Subnet",
        "VpcId": {"Ref" :"EC2_VPC_0"},
        "CidrBlock":{"Ref":"Subnet_CIDR_1"},
        "Properties":{}
      },
      "EC2_SUBNET_2":{        
        "Type":"AWS::EC2::Subnet",
        "VpcId": {"Ref" :"EC2_VPC_0"},
        "CidrBlock":{"Ref":"Subnet_CIDR_2"},
        "Properties":{}
      },
      "EC2_InternetGateway":{
        "Type":"AWS::EC2::InternetGateway",
        "DependsOn": "EC2_VPC_0",
        "properties":{}
      },
      "AttachGateway":{
        "Type":"AWS::EC2::VPCGatewayAttachment",
        "properties":{
          "VpcId":{"Ref":"EC2_VPC_0"},
          "InternetGatewayId":{"Ref":"EC2_InternetGateway"}
        }
      },
      "EC2_RouteTable":{
        "Type":"AWS::EC2::RouteTable",
        "properties":{
          "VpcId":{"Ref":"EC2_VPC_0"},
          "Tags":[{"Key":"Name","Value":"RouteTable"}]
        }
      },
      "RouteTableAssociationWithEC2_SUBNET_0" : {
          "Type" : "AWS::EC2::SubnetRouteTableAssociation",
          "Properties" : {
            "SubnetId" : { "Ref" : "mySubnet" },
            "RouteTableId" : { "Ref" : "EC2_SUBNET_0" }
          }
      },
      "RouteTableAssociationWithEC2_SUBNET_1" : {
        "Type" : "AWS::EC2::SubnetRouteTableAssociation",
        "Properties" : {
          "SubnetId" : { "Ref" : "mySubnet" },
          "RouteTableId" : { "Ref" : "EC2_SUBNET_1" }
        }
      },
      "RouteTableAssociationWithEC2_SUBNET_2" : {
        "Type" : "AWS::EC2::SubnetRouteTableAssociation",
        "Properties" : {
          "SubnetId" : { "Ref" : "mySubnet" },
          "RouteTableId" : { "Ref" : "EC2_SUBNET_2" }
        }
      },
      "EC2_Route":{
        "Type": "AWS::EC2::Route",
        "DependsOn" : "GatewayToInternet",
        "Properties" : {
          "RouteTableId" : { "Ref" : "EC2_RouteTable" },
          "DestinationCidrBlock" : "0.0.0.0/0",
          "GatewayId" : { "Ref" : "EC2_InternetGateway" }
       }
      }
    },
    "Outputs": {
      "InstanceId": {
        "Description": "InstanceId of the newly created EC2 instance",
        "Value": {
          "Ref": "EC2Instance"
        }
      },
      "AZ": {
        "Description": "Availability Zone of the newly created EC2 instance",
        "Value": {
          "Fn::GetAtt": [
            "EC2Instance",
            "AvailabilityZone"
          ]      
        }
    },
    "PublicDNS": {
      "Description": "Public DNSName of the newly created EC2 instance",
      "Value": {
        "Fn::GetAtt": [
          "EC2Instance",
          "PublicDnsName"
        ]
      }
    },
    "PublicIP": {
      "Description": "Public IP address of the newly created EC2 instance",
      "Value": {
        "Fn::GetAtt": [
          "EC2Instance",
          "PublicIp"
        ]
      }
    }
  }
}